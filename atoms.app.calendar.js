(function(){"use strict";var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};__.Extension.Calendar={},__.Extension.Calendar.Day=function(_super){function Day(){return Day.__super__.constructor.apply(this,arguments)}return __extends(Day,_super),Day.template='<span class="{{style}} {{#disabled}}disabled{{/disabled}} {{#today}}today{{/today}} {{#active}}active{{/active}} {{#if.event}}event{{/if.event}}">{{day}}</span>',Day.base="Day",Day.events=["touch"],Day["default"]={events:["touch"]},Day.prototype.setEvent=function(value){return this.refresh({event:value})},Day.prototype.removeEvent=function(){return this.refresh({event:void 0})},Day}(Atoms.Class.Atom),Atoms.Molecule.Calendar=function(_super){function Calendar(attributes){var key,_i,_len,_ref;for(null==attributes&&(attributes={}),_ref=["months","days"],_i=0,_len=_ref.length;_len>_i;_i++)key=_ref[_i],attributes[key]||(attributes[key]=this.constructor["default"][key]);Calendar.__super__.constructor.call(this,attributes),this.events={},this.today=new Date,this.today=new Date(this.today.getFullYear(),this.today.getMonth(),this.today.getDate()),this.date(new Date(attributes.date||this.today))}return __extends(Calendar,_super),Calendar["extends"]=!0,Calendar.available=["Atom.Day","Atom.Heading"],Calendar.events=["select"],Calendar["default"]={months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],children:[{"Atom.Heading":{id:"literal",value:"Year",size:"h4"}}]},Calendar.prototype.e=[],Calendar.prototype.date=function(current){var child,class_name,date,day,first_day_of_month,index,last_day_of_month,month,next_month,previous_days,previous_month,values,year,_i,_j,_k,_l,_len,_len1,_m,_ref,_ref1,_ref2,_results;for(this.current=null!=current?current:new Date,_ref=this.children,_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],"Day"===child.constructor.name&&child.destroy();for(day=this.current.getDate(),month=this.current.getMonth(),year=this.current.getFullYear(),this.literal.el.html(""+this.attributes.months[month]+" <small>"+year+"</small>"),class_name="App.Extension.Calendar.Day",_ref1=this.attributes.days,_j=0,_len1=_ref1.length;_len1>_j;_j++)day=_ref1[_j],this.appendChild(class_name,{day:day,events:void 0});for(first_day_of_month=new Date(year,month).getDay()-1,previous_month=this._previousMonth(month,year),previous_days=this._daysInMonth(previous_month)-(first_day_of_month-1),day=_k=0;first_day_of_month>=0?first_day_of_month>_k:_k>first_day_of_month;day=first_day_of_month>=0?++_k:--_k)values={day:previous_days,date:new Date(previous_month.setDate(previous_days)),disabled:!0},this.attributes.disable_previous_days&&values.date<this.today&&(values.events=void 0),this.appendChild(class_name,values),previous_days++;for(day=_l=1,_ref2=this._daysInMonth();_ref2>=1?_ref2>=_l:_l>=_ref2;day=_ref2>=1?++_l:--_l)date=new Date(year,month,day),values={day:day,date:date,today:this.today.toString().substring(4,15)===date.toString().substring(4,15),active:this.current.toString().substring(4,15)===date.toString().substring(4,15)},null!=this.events[date]&&(values.event=this.events[date]),this.attributes.disable_previous_days&&date<this.today&&(values.disabled=!0,values.events=void 0),this.appendChild(class_name,values);for(next_month=this._nextMonth(month,year),last_day_of_month=new Date(year,month,this._daysInMonth()).getDay(),day=1,_results=[],index=_m=6;last_day_of_month>=6?last_day_of_month>=_m:_m>=last_day_of_month;index=last_day_of_month>=6?++_m:--_m)this.appendChild(class_name,{day:day,date:new Date(next_month.setDate(day)),disabled:!0}),_results.push(day++);return _results},Calendar.prototype.setEvent=function(date,value){var _ref;return null==value&&(value={}),this.events[date]=value,null!=(_ref=this._find(date))&&"function"==typeof _ref.setEvent?_ref.setEvent(value):void 0},Calendar.prototype.removeEvent=function(date){var _ref;return delete this.events[date],null!=(_ref=this._find(date))&&"function"==typeof _ref.removeEvent?_ref.removeEvent():void 0},Calendar.prototype.onDayTouch=function(event,atom){var _ref;return null!=(_ref=atom.el.addClass("active").siblings("[data-atom-day]"))&&_ref.removeClass("active"),this.bubble("select",atom.attributes.date),atom.attributes.date.getMonth()!==this.current.getMonth()&&this.date(atom.attributes.date),this.current=atom.attributes.date,!1},Calendar.prototype._previousMonth=function(month,year){return new Date(year,month-1,1)},Calendar.prototype._nextMonth=function(month,year){return new Date(year,month+1,1)},Calendar.prototype._daysInMonth=function(date){return null==date&&(date=this.current),32-new Date(date.getYear(),date.getMonth(),32).getDate()},Calendar.prototype._find=function(date){var day,_i,_len,_ref;for(_ref=this.children,_i=0,_len=_ref.length;_len>_i;_i++)if(day=_ref[_i],date-day.attributes.date===0)return day},Calendar}(Atoms.Molecule.Div)}).call(this);